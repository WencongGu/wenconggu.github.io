---
title: python进阶-魔术方法
date: 2024-01-31 13:26:56
tags: Python
---

python中的魔术方法在自定义类时比较有用。在涉及深度学习的模块中常常需要自己设计模型结构，而模型的各个结构都是用类定义，这时就会需要对类的操作有一定了解。同时熟悉python中的类也有助于设计不同的模块或者数据结构来满足不同的需求。

相关的用法我已经有很多实践了，这篇文章只是简单总结整理，便于查找，同时加入一些新的内容。

<!--more-->

在 Python 中，**魔术方法**（**Magic Methods**）是以双下划线 `__` 开头和结尾的特殊方法，用于实现类的特定行为和操作。这些方法在 Python 中被广泛使用，可以让我们自定义类的行为，使其更符合我们的需求。以下是一些常用的魔术方法：

- **`__str__(self) -> str`**: 返回对象的字符串表示，通常用于 print(obj) 时调用。
- **`__repr__(self) -> str`**: 返回对象的 “官方” 字符串表示，通常用于调试和日志记录。
- **`__len__(self) -> int`**: 返回对象的长度，通常用于内置函数 len(obj)。
- **`__getitem__(self, key) -> Any`**: 使用索引值获取对象或者某个值，通常用于支持索引操作。
- **`__setitem__(self, key, value) -> None`**: 设置对象的索引值，通常用于支持赋值操作。
- **`__delitem__(self, key) -> None`**: 删除对象的索引值，通常用于支持 `del obj[key]` 操作。
- **`__iter__(self)`**: 返回一个迭代器对象，通常用于支持对象的迭代。
  >迭代器对象必须实现 `__iter__()` 和 `__next__()` 方法，这样它们就可以被 `for` 循环或者 `next()` 函数使用。Python中还有一个可迭代对象（Iterable）的概念，可迭代对象是实现了 `__iter__()` 方法的对象，通过调用 `iter()` 函数可以获取对应的迭代器对象。因此，迭代器是可迭代对象的一种特殊形式，它不仅可以遍历集合元素，还可以保持迭代状态。
- **`__next__(self)`**: 返回迭代器的下一个元素，通常与 `__iter__` 方法一起使用。
- **`__contains__(self, item) -> bool`**: 判断对象是否包含某个元素，通常用于支持 `in` 操作符。
- **`__call__(self, ...)`**: 当对象被调用时调用，使对象可以像函数一样被调用。
- **数学运算符重载**
  + **`__add__(self, other)`**: 定义对象的加法操作，通常用于支持 `+` 操作符。
  + **`__sub__(self, other)`**: 定义对象的减法操作，通常用于支持 `-` 操作符。
  + **`__mul__(self, other)`**: 用于实现对象的乘法运算，即使用 `*` 运算符对对象进行乘法操作时调用该方法。
  + **`__mod__(Self, other)`**: 用于实现对象的取模运算，即使用 `%` 运算符对对象进行取模操作时调用该方法。
- **比较运算符重载  `-> None`**：
  + **`__lt__(self, other)`**: 定义对象的小于比较，通常用于支持 `<` 操作符。
  + **`__le__(self, other)`**: 定义对象的小于等于比较，通常用于支持 `<=` 操作符。
  + **`__gt__(self, other)`**: 定义对象的大于比较，通常用于支持 `>` 操作符。
  + **`__ge__(self, other)`**: 定义对象的大于等于比较，通常用于支持 `>=` 操作符。
    >定义以上4个比较运算多魔术方法的类，其对象就支持排序操作了，对象的数组就可以使用 `sort()` 方法了，类似 Java 中的 `Comparable` 接口。
  + **`__eq__(self, other)`**: 定义对象的相等比较，通常用于支持 `==` 操作符。
  + **`__ne__(self, other)`**: 定义对象的不等比较，通常用于支持 `!=` 操作符。
  

未完，但是够用了，有需求再查资料，因为很多其他的方法基本只会用于设计自己的库时才会使用，作为库的调用者、问题解决者一般用不到。